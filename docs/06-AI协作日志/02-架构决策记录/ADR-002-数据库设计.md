# ADR-002: 数据库核心表设计

| 字段 | 内容 |
|------|------|
| 编号 | ADR-002 |
| 日期 | 2026-02-17 |
| 状态 | 已接受 |
| 决策人 | 唐伯虎 + Claude AI |

## 背景

需要设计支持"易经人生规划"业务的数据库表结构。
核心业务：用户管理、规划记录、卦象数据、占卜记录。

## 决策

### 4张核心表

1. **users** - 用户表
   - `current_stage`：记录当前人生阶段（6个易经阶段）
   - `stage_score`：积分系统，支持阶段晋升

2. **planning_records** - 规划记录表
   - `type` ENUM：life/career/project/mood/health/time/habit
   - `status` ENUM：active/completed/paused/cancelled
   - `iching_advice` TEXT(JSON)：存储易经给出的建议

3. **iching_hexagrams** - 64卦静态数据表
   - 初始化时导入64条，业务不修改
   - `planning_advice` JSON：各规划类型对应的卦辞建议

4. **divination_records** - 占卜记录表
   - 记录每次起卦的问题、方法、结果
   - 支持变卦（changing_hexagram_id）

### 通用设计原则
- 所有表包含 `created_at`, `updated_at`, `deleted_at`（软删除）
- 字符集：utf8mb4 / utf8mb4_unicode_ci（支持emoji）
- 主键：INT UNSIGNED AUTO_INCREMENT

## 后果

- 4表结构简洁，足以支持MVP
- 规划记录用 ENUM type 而非单独表，简化查询
- iching_hexagrams 静态化，避免意外修改卦象数据
- 后续扩展：可增加 habit_logs（习惯打卡日志）、mood_diary（情绪日记）等子表
