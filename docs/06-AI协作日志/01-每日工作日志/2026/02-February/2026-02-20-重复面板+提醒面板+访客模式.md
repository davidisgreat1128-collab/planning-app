# å·¥ä½œæ—¥å¿— - 2026-02-20

## åŸºæœ¬ä¿¡æ¯

| å­—æ®µ | å†…å®¹ |
|------|------|
| æ—¥æœŸ | 2026-02-20 |
| Claudeä¼šè¯æ¬¡æ•° | 1æ¬¡ï¼ˆç¬¬16æ¬¡ä¼šè¯ï¼Œcontextç»­æ¥ï¼‰ |
| ä¸»è¦è´Ÿè´£äºº | Claude AI |
| å®¡æ ¸äºº | å”ä¼¯è™ |

---

## ä»Šæ—¥ç›®æ ‡

1. âœ… å®Œæˆ RepeatPanel.vue è„šæœ¬éƒ¨åˆ†ï¼ˆæ¯æœˆ/æ¯å¹´é€»è¾‘ï¼‰
2. âœ… ä¿®å¤ WheelPicker H5 ç«¯ä¸¤ä¸ªé—®é¢˜ï¼ˆåº•éƒ¨æˆªæ–­ + é€‰ä¸­é¡¹ç©ºç™½ï¼‰
3. âœ… ä¿®å¤æäº¤æŠ¥é”™ï¼š"é‡å¤ä»»åŠ¡éœ€è¦æä¾› rule è§„åˆ™"
4. âœ… ä¿®å¤ startDate is required é”™è¯¯
5. âœ… å®ç°æé†’é¢æ¿ ReminderPanel.vueï¼ˆå¯¹åº”è®¾è®¡å›¾32-36.jpgï¼‰
6. âœ… ä¿®å¤ showLoading/hideLoading é…å¯¹è­¦å‘Š
7. âœ… æ’æŸ¥å¹¶ä¿®å¤"ä¸€æ¬¡æäº¤UIæ˜¾ç¤ºä¸¤æ¡"é”™è¯¯
8. âœ… å®ç°è®¿å®¢æ¨¡å¼å¼€å…³ï¼ˆç™»å½•é¡µå³ä¸Šè§’å¼€å…³ï¼‰

---

## è¯¦ç»†å·¥ä½œè®°å½•

### Phase 1 - å®Œæˆ RepeatPanel.vue è„šæœ¬

**æ–‡ä»¶**ï¼š`frontend/Planning-app/components/task/RepeatPanel.vue`

**èƒŒæ™¯**ï¼šä¸Šä¸€ä¼šè¯å·²å®Œæˆæ¨¡æ¿å’ŒCSSï¼Œæœ¬æ¬¡è¡¥å…¨è„šæœ¬é€»è¾‘

**æ–°å¢å†…å®¹**ï¼š

1. **æ¯æœˆæ¨¡å¼ï¼ˆmonthlyï¼‰**ï¼š
   - `monthDays`ï¼šæ—¥æœŸæ•°ç»„ï¼ˆå¤šé€‰ï¼‰
   - `monthlySubMode`ï¼š`'date'`ï¼ˆæŒ‰æ—¥æœŸï¼‰æˆ– `'week'`ï¼ˆæŒ‰æ˜ŸæœŸï¼‰
   - `monthWeekOrdinal`ï¼šç¬¬å‡ ä¸ªï¼ˆ0-4ï¼Œ4ä»£è¡¨æœ€åä¸€ä¸ªï¼‰
   - `monthWeekDay`ï¼šæ˜ŸæœŸå‡ ï¼ˆ0-6ï¼‰
   - `weekOrdinalLabels`ï¼š['ç¬¬ä¸€ä¸ª', 'ç¬¬äºŒä¸ª', 'ç¬¬ä¸‰ä¸ª', 'ç¬¬å››ä¸ª', 'æœ€åä¸€ä¸ª']
   - `weekDayFullLabels`ï¼š['æ˜ŸæœŸä¸€', ..., 'æ˜ŸæœŸæ—¥']
   - WheelPicker å¼¹çª—ï¼š`showMonthOrdinalWheel` / `showMonthWeekDayWheel`

2. **æ¯å¹´æ¨¡å¼ï¼ˆyearlyï¼‰**ï¼š
   - `yearlyMonth`ï¼šæœˆä»½ï¼ˆ1-12ï¼‰
   - `yearlyDay`ï¼šæ—¥ï¼ˆ1-31ï¼‰
   - `monthItems` / `dayItems` / `intervalItems`ï¼šWheelPicker æ•°æ®æº
   - WheelPicker å¼¹çª—ï¼š`showYearlyMonthWheel` / `showYearlyDayWheel` / `showYearlyIntervalWheel`

3. **æ ¸å¿ƒæ–¹æ³•**ï¼š
   - `selectMode(key)`ï¼šåˆ‡æ¢æ¨¡å¼æ—¶é‡ç½®æ‰€æœ‰å­çŠ¶æ€ï¼Œæ¯æœˆ/æ¯å¹´é»˜è®¤å€¼å–å½“å‰æ—¥æœŸ
   - `emitData()`ï¼šå‘çˆ¶ç»„ä»¶å‘å°„å®Œæ•´ `repeatData` å¯¹è±¡

4. **import WheelPicker**ï¼š
   ```js
   import WheelPicker from './WheelPicker.vue';
   ```

5. **watch(visible)**ï¼šä¿®æ­£ä¸ºç›‘å¬æ‰€æœ‰ç›¸å…³å­çŠ¶æ€å˜åŒ–æ—¶è°ƒç”¨ `emitData()`

**æ–°å¢CSS**ï¼š
- `.rp-month-sub-tabs` / `.rp-month-day-chips` / `.rp-month-week-row`
- `.rp-year-row` / `.rp-end-row`

---

### Phase 2 - ä¿®å¤ WheelPicker H5 ç«¯é—®é¢˜

**æ–‡ä»¶**ï¼š`frontend/Planning-app/components/task/WheelPicker.vue`

**é—®é¢˜1ï¼šåº•éƒ¨æŒ‰é’®è¢«æˆªæ–­**
- **æ ¹å› **ï¼šH5 ç«¯åº•éƒ¨æµè§ˆå™¨å¯¼èˆªæ é®æŒ¡ï¼Œæ— å®‰å…¨åŒº padding
- **ä¿®å¤**ï¼š`.wp-sheet` æ–°å¢ `padding-bottom: env(safe-area-inset-bottom, 0px)`

**é—®é¢˜2ï¼šé€‰ä¸­é¡¹åŒºåŸŸç©ºç™½ï¼ˆçº¢æ¡†æ— å†…å®¹ï¼‰**
- **æ ¹å› **ï¼šH5 `<picker>` å†…éƒ¨ slot çš„ flex å¸ƒå±€å­å…ƒç´ ä¸å‚ä¸æ¸²æŸ“
- **åˆ†æ**ï¼šåŸè®¾è®¡ç”¨ `v-for` å¾ªç¯æ¸²æŸ“å­å…ƒç´ ï¼Œä½† picker å†…éƒ¨ä¸æ”¯æŒ
- **ä¿®å¤**ï¼šæ”¹ä¸ºé™æ€5ä¸ª `<view>` ç›´æ¥è¯»å– `tempIndex-2` ~ `tempIndex+2` çš„å€¼ï¼š
  ```html
  <view class="wp-picker-h5-display">
    <view class="wp-item-selected-bg-h5"></view>
    <view class="wp-item"><text class="wp-item-text wp-item-text-fade">{{ items[tempIndex - 2] !== undefined ? items[tempIndex - 2] : '' }}</text></view>
    <view class="wp-item"><text class="wp-item-text wp-item-text-near">{{ items[tempIndex - 1] !== undefined ? items[tempIndex - 1] : '' }}</text></view>
    <view class="wp-item"><text class="wp-item-text wp-item-text-active">{{ items[tempIndex] !== undefined ? items[tempIndex] : '' }}</text></view>
    <view class="wp-item"><text class="wp-item-text wp-item-text-near">{{ items[tempIndex + 1] !== undefined ? items[tempIndex + 1] : '' }}</text></view>
    <view class="wp-item"><text class="wp-item-text wp-item-text-fade">{{ items[tempIndex + 2] !== undefined ? items[tempIndex + 2] : '' }}</text></view>
  </view>
  ```
- **æ–°å¢CSS**ï¼š`.wp-item-selected-bg-h5`ï¼ˆç»å¯¹å®šä½ç°è‰²èƒŒæ™¯æ¡ï¼‰ï¼Œ`.wp-picker-h5-display .wp-item { position: relative; z-index: 1; }`

---

### Phase 3 - ä¿®å¤"é‡å¤ä»»åŠ¡éœ€è¦æä¾› rule è§„åˆ™"

**æ–‡ä»¶**ï¼š`frontend/Planning-app/components/task/AddTaskPanel.vue`

**é—®é¢˜**ï¼šæäº¤é‡å¤ä»»åŠ¡æ—¶åç«¯æŠ¥é”™ï¼Œè¦æ±‚ `rrule` å­—æ®µ

**æ ¹å› **ï¼š
- åç«¯è¦æ±‚æ ‡å‡† RRULE æ ¼å¼å­—ç¬¦ä¸²ï¼ˆå¦‚ `FREQ=DAILY;INTERVAL=2;BYDAY=MO,TH`ï¼‰
- å‰ç«¯å‘é€çš„æ˜¯è‡ªå®šä¹‰å­—æ®µï¼ˆ`mode`, `interval`, `weekDays` ç­‰ï¼‰

**ä¿®å¤**ï¼šæ–°å¢ `buildRrule(rd)` å‡½æ•°ï¼Œå‚è€ƒ `task-edit.vue` å·²æœ‰é€»è¾‘ï¼š

```js
function buildRrule(rd) {
  if (!rd || rd.mode === 'none') return '';
  const freqMap = { daily:'DAILY', weekly:'WEEKLY', monthly:'MONTHLY', yearly:'YEARLY' };
  const freq = freqMap[rd.mode];
  if (!freq) return '';
  const parts = [`FREQ=${freq}`];

  if (rd.interval > 1) parts.push(`INTERVAL=${rd.interval}`);

  // æ¯å‘¨ â†’ BYDAY
  if (rd.mode === 'weekly' && rd.weekDays?.length > 0) {
    const dayMap = ['MO','TU','WE','TH','FR','SA','SU'];
    parts.push(`BYDAY=${rd.weekDays.map(d => dayMap[d]).join(',')}`);
  }

  // æ¯æœˆ-æ—¥æœŸæ¨¡å¼ â†’ BYMONTHDAY
  if (rd.mode === 'monthly' && rd.monthlySubMode === 'date' && rd.monthDays?.length > 0) {
    parts.push(`BYMONTHDAY=${rd.monthDays.join(',')}`);
  }

  // æ¯æœˆ-æ˜ŸæœŸæ¨¡å¼ â†’ BYDAYï¼ˆå¦‚ 1MO = ç¬¬ä¸€ä¸ªæ˜ŸæœŸä¸€ï¼Œ-1SU = æœ€åä¸€ä¸ªæ˜ŸæœŸæ—¥ï¼‰
  if (rd.mode === 'monthly' && rd.monthlySubMode === 'week') {
    const dayMap = ['MO','TU','WE','TH','FR','SA','SU'];
    const pos = rd.monthWeekOrdinal === 4 ? -1 : rd.monthWeekOrdinal + 1;
    parts.push(`BYDAY=${pos}${dayMap[rd.monthWeekDay]}`);
  }

  // æ¯å¹´ â†’ BYMONTH + BYMONTHDAY
  if (rd.mode === 'yearly') {
    parts.push(`BYMONTH=${rd.yearlyMonth}`);
    parts.push(`BYMONTHDAY=${rd.yearlyDay}`);
  }

  // ç»“æŸæ—¥æœŸ â†’ UNTILï¼ˆè½¬ä¸º UTC æ ¼å¼ï¼šYYYYMMDDTHHMMSSZï¼‰
  if (rd.endDate) {
    parts.push(`UNTIL=${rd.endDate.replace(/-/g,'')}T235959Z`);
  }

  return parts.join(';');
}
```

**payloadä¿®æ”¹**ï¼š
```js
const rrule = buildRrule(rd);
// ...
payload.isRecurring = rd.mode !== 'none';
payload.rrule = rrule;
```

---

### Phase 4 - ä¿®å¤ startDate is required é”™è¯¯

**æ–‡ä»¶**ï¼š`frontend/Planning-app/components/task/AddTaskPanel.vue`

**é—®é¢˜**ï¼šæäº¤è·¨å¤©ä»»åŠ¡æ—¶æŠ¥é”™ `startDate is required`

**æ ¹å› **ï¼š
- åç«¯ `dateType='range'` æ—¶éœ€è¦ `startDate` + `endDate`
- å‰ç«¯é”™è¯¯å‘é€äº† `taskDate`

**dateTypeå­—æ®µè¯´æ˜**ï¼š
- `'single'`ï¼šå•æ—¥ä»»åŠ¡ï¼Œä½¿ç”¨ `taskDate`
- `'range'`ï¼šè·¨å¤©ä»»åŠ¡ï¼Œä½¿ç”¨ `startDate` + `endDate`

**ä¿®å¤**ï¼šåœ¨ `submit()` ä¸­æŒ‰ `hasDayRange` åˆ†æ”¯å‘é€ä¸åŒå­—æ®µï¼š

```js
if (hasDayRange) {
  payload.startDate = todayStr;
  payload.endDate = endDate.value ? formatDate(endDate.value) : todayStr;
} else {
  payload.taskDate = todayStr;
}
```

---

### Phase 5 - å®ç°æé†’é¢æ¿ ReminderPanel.vue

**å¯¹åº”è®¾è®¡å›¾**ï¼š32.jpg / 33.jpg / 34.jpg / 35.jpg / 36.jpg

**æ–°å»ºæ–‡ä»¶**ï¼š`frontend/Planning-app/components/task/ReminderPanel.vue`

**è®¾è®¡è¦æ±‚**ï¼š

1. **32.jpgï¼ˆä¸»é¢æ¿ï¼‰**ï¼š
   - æé†’æ—¶é—´è¡Œï¼šæœªå¼€å¯ï¼ˆç°è‰²ï¼‰/ å·²è®¾ç½®ï¼ˆæ˜¾ç¤ºæ—¶é—´ + æ¸…é™¤æŒ‰é’®ï¼‰
   - å¼ºåŠ›æé†’å¡ç‰‡åŒºï¼šæŒç»­æé†’ switch + å¾®ä¿¡è¾…åŠ©æé†’ï¼ˆå³ç®­å¤´ï¼‰
   - åº•éƒ¨ï¼šå–æ¶ˆ / ç¡®å®š

2. **33.jpgï¼ˆé»˜è®¤å¼¹çª—ï¼‰**ï¼š
   - ä¸¤ä¸ªTabï¼šæŒ‰å¤©æå‰ / æŒ‰å‘¨æå‰
   - ä¸‰åˆ— WheelPickerï¼šæå‰é‡ + æ—¶ + åˆ†
   - é»˜è®¤ï¼šå½“å‰æ—¶é—´ï¼ˆ`new Date()`ï¼Œç²¾ç¡®åˆ°åˆ†é’Ÿï¼‰
   - åº•éƒ¨å®æ—¶æç¤ºï¼šçº¢è‰²åº• + çº¢å­—"æ— æ•ˆçš„æé†’æ—¶é—´"ï¼ˆæœªæ¥æ—¶é—´æ‰æœ‰æ•ˆï¼‰

3. **34.jpgï¼ˆæœ‰æ•ˆæé†’ï¼‰**ï¼š
   - åº•éƒ¨å˜é»‘å­—ï¼š"å°†äºXæœˆXæ—¥ï¼ŒHH:MMæé†’ä½ "ï¼ˆæ— åº•è‰²ï¼‰

4. **35.jpgï¼ˆæŒ‰å¤©æå‰ï¼‰**ï¼š
   - Tabåˆ‡æ¢åˆ°"æŒ‰å¤©æå‰"
   - ç¤ºä¾‹ï¼šå½“å‰04:26 â†’ æå‰1å¤©04:26 â†’ æ˜¨å¤© â†’ æ— æ•ˆï¼ˆçº¢åº•ï¼‰

5. **36.jpgï¼ˆæŒ‰å‘¨æå‰ï¼‰**ï¼š
   - Tabåˆ‡æ¢åˆ°"æŒ‰å‘¨æå‰"
   - æå‰é‡å•ä½å˜"å‘¨"

**æ ¸å¿ƒå®ç°**ï¼š

**æœ‰æ•ˆæ€§åˆ¤æ–­**ï¼ˆç²¾ç¡®åˆ°åˆ†é’Ÿï¼Œç­‰äºä¹Ÿç®—æ— æ•ˆï¼‰ï¼š
```js
function checkValid() {
  const target = calcReminderDate();
  const now = new Date();
  now.setSeconds(0, 0);
  target.setSeconds(0, 0);

  if (target.getTime() > now.getTime()) {
    pickerValid.value = true;
    const m = target.getMonth() + 1, d = target.getDate();
    const hh = String(target.getHours()).padStart(2, '0');
    const mm = String(target.getMinutes()).padStart(2, '0');
    pickerPreviewLabel.value = `å°†äº${m}æœˆ${d}æ—¥ï¼Œ${hh}:${mm}æé†’ä½ `;
  } else {
    pickerValid.value = false;
    pickerPreviewLabel.value = '';
  }
}
```

**calcReminderDate()**ï¼š
```js
function calcReminderDate() {
  const taskDt = new Date(props.taskDate);
  taskDt.setHours(pickerHour.value, pickerMinute.value, 0, 0);

  if (advanceMode.value === 'day') {
    taskDt.setDate(taskDt.getDate() - advanceValue.value);
  } else {
    taskDt.setDate(taskDt.getDate() - advanceValue.value * 7);
  }

  return taskDt;
}
```

**H5 / App åŒç«¯é€‚é…**ï¼š
- H5ï¼šä¸‰ä¸ª `<picker mode="selector">` æ¨¡æ‹Ÿæ»šè½®
- Appï¼šä¸‰ä¸ª `<scroll-view>` + `scroll-into-view` æ¨¡æ‹Ÿæ»šè½®

**emitäº‹ä»¶**ï¼š
- `update:reminderData`ï¼šå®æ—¶æ›´æ–°çˆ¶ç»„ä»¶çŠ¶æ€
- `confirm`ï¼šç¡®è®¤ï¼ˆå…³é—­å¼¹çª—ï¼‰
- `cancel`ï¼šå–æ¶ˆï¼ˆå…³é—­å¼¹çª—ï¼‰

**é›†æˆåˆ° AddTaskPanel.vue**ï¼š
```html
<reminder-panel
  :visible="showReminderPanel"
  :taskDate="resolvedDate || getTodayStr()"
  @update:reminderData="onReminderDataUpdate"
  @confirm="onReminderConfirm"
  @cancel="onReminderCancel"
/>
```

---

### Phase 6 - ä¿®å¤ showLoading/hideLoading é…å¯¹è­¦å‘Š

**æ–‡ä»¶**ï¼š`frontend/Planning-app/components/task/AddTaskPanel.vue`

**é—®é¢˜**ï¼šæ§åˆ¶å°è­¦å‘Š `showLoading ä¸ hideLoading å¿…é¡»é…å¯¹ä½¿ç”¨`

**æ ¹å› **ï¼š
- `uni.showToast()` ä¼šéšå¼å…³é—­ loading
- `finally` å—ä¸­å†æ¬¡è°ƒç”¨ `hideLoading()` å¯¼è‡´ä¸é…å¯¹

**ä¿®å¤**ï¼š
- åˆ é™¤ `finally` å—
- åœ¨å„åˆ†æ”¯çš„ `showToast()` **ä¹‹å‰**æ‰‹åŠ¨è°ƒç”¨ `hideLoading()`

```js
try {
  await taskStore.addTask(payload);
  uni.hideLoading();  // å…ˆå…³é—­ loading
  resetPanel();
  emit('submitted');
  closePanel();
  uni.showToast({ title: 'å·²æ·»åŠ ', icon: 'success' });
} catch (err) {
  uni.hideLoading();  // å…ˆå…³é—­ loading
  uni.showToast({ title: err.message || 'ä¿å­˜å¤±è´¥', icon: 'none' });
}
// åˆ é™¤åŸæœ‰ finally { uni.hideLoading(); }
```

---

### Phase 7 - æ’æŸ¥"ä¸€æ¬¡æäº¤UIæ˜¾ç¤ºä¸¤æ¡"é”™è¯¯

**é—®é¢˜ç°è±¡**ï¼šç”¨æˆ·æäº¤ä¸€ä¸ªä»»åŠ¡ï¼ŒUI ä¸­æ˜¾ç¤ºä¸ºä¸¤æ¡

**æ’æŸ¥è¿‡ç¨‹**ï¼š

**ç¬¬ä¸€è½®ï¼šæ·»åŠ è¯¦ç»† DEBUG æ—¥å¿—**

1. **AddTaskPanel.vue submit()**ï¼š
   ```js
   console.log('[DEBUG AddTaskPanel] submit() called', new Date().toISOString());
   console.log('[DEBUG AddTaskPanel] payload:', JSON.stringify(payload));
   ```

2. **store/task.js addTask()**ï¼š
   ```js
   console.log('[DEBUG taskStore] addTask() called from:', new Error().stack);
   console.log('[DEBUG taskStore] payload:', JSON.stringify(data));
   ```

3. **store/task.js fetchTasksByDate()**ï¼š
   ```js
   console.log('[DEBUG taskStore] fetchTasksByDate result:', {
     single: result.single.length,
     range: result.range.length,
     recurring: result.recurring.length
   });
   ```

4. **index.vue onTaskSubmitted()**ï¼š
   ```js
   console.log('[DEBUG index] onTaskSubmitted() called', new Date().toISOString());
   console.log('[DEBUG index] after fetch, tasks.value.length =', tasks.value.length);
   ```

**ç¬¬äºŒè½®ï¼šæ·»åŠ é˜²é‡å¤æäº¤æ ‡å¿—**

```js
let _submitting = false;

async function submit() {
  if (!form.value.title.trim()) { ... return; }
  if (_submitting) return;
  _submitting = true;
  try {
    ...
  } finally {
    _submitting = false;
  }
}
```

**æ—¥å¿—åˆ†æ**ï¼š

ç”¨æˆ·æä¾›çš„æ—¥å¿—æ˜¾ç¤ºï¼š
- `submit()` åªè°ƒç”¨ 1 æ¬¡ âœ“
- `addTask()` åªè°ƒç”¨ 1 æ¬¡ âœ“
- `fetchTasksByDate()` è¿”å›ï¼š`single=3, range=3, recurring=5` = 11 æ¡ï¼ˆä¹‹å‰æ˜¯ 9 æ¡ï¼‰
- **ç»“è®º**ï¼šåç«¯è¿”å›äº†é‡å¤æ•°æ®ï¼ŒåŒä¸€ä»»åŠ¡åŒæ—¶å‡ºç°åœ¨ `range[]` å’Œ `recurring[]` ä¸¤ä¸ªåˆ—è¡¨

**æ ¹å› å®šä½**ï¼š

æ£€æŸ¥ payload å‘ç°ï¼š
```json
{
  "dateType": "range",
  "startDate": "2026-02-20",
  "endDate": "2026-02-21",
  "isRecurring": true,
  "rrule": "FREQ=WEEKLY;BYDAY=FR"
}
```

**è¯­ä¹‰å†²çª**ï¼š
- `dateType='range'` â†’ åç«¯å½’å…¥ `range[]`
- `isRecurring=true` + `rrule` â†’ åç«¯å½’å…¥ `recurring[]`
- **åŒä¸€ä»»åŠ¡è¢«ä¸¤ä¸ªåˆ—è¡¨åŒ…å« â†’ å‰ç«¯åˆå¹¶åæ˜¾ç¤ºä¸¤æ¡**

**æ ¸å¿ƒä¿®å¤**ï¼šè·¨å¤©ä»»åŠ¡ä¸é‡å¤ä»»åŠ¡äº’æ–¥

```js
// ä¿®å¤å‰
const isRecurring = rd.mode !== 'none';

// ä¿®å¤å
const isRecurring = !hasDayRange && rd.mode !== 'none';
```

**é€»è¾‘**ï¼š
- è·¨å¤©ä»»åŠ¡ï¼ˆ`hasDayRange=true`ï¼‰â†’ å¼ºåˆ¶ `isRecurring=false`ï¼Œä¸å‘é€ `rrule`
- å•æ—¥ä»»åŠ¡ + é‡å¤æ¨¡å¼ â†’ `isRecurring=true`ï¼Œå‘é€ `rrule`

---

### Phase 8 - æ¸…é™¤ DEBUG æ—¥å¿—

ä¿®å¤å®Œæˆåï¼Œåˆ é™¤æ‰€æœ‰ä¸‰ä¸ªæ–‡ä»¶ä¸­çš„ DEBUG æ—¥å¿—ï¼š
- `AddTaskPanel.vue`ï¼šåˆ é™¤ `submit()` ä¸­çš„ 4 è¡Œ console.log
- `store/task.js`ï¼šåˆ é™¤ `addTask()` å’Œ `fetchTasksByDate()` ä¸­çš„ 6 è¡Œ console.log
- `index.vue`ï¼šåˆ é™¤ `onTaskSubmitted()` ä¸­çš„ 2 è¡Œ console.log

åŒæ—¶ç§»é™¤ `store/task.js` ä¸­ `addTask()` çš„ä¹è§‚ `unshift`ï¼ˆé¿å…ä¸å…¨é‡åˆ·æ–°é‡å¤ï¼‰ï¼š

```js
// ä¿®å¤å‰
async function addTask(data) {
  const newTask = await createTask(data);
  tasks.value.unshift(newTask);  // ä¹è§‚æ’å…¥
  return newTask;
}

// ä¿®å¤å
async function addTask(data) {
  const newTask = await createTask(data);
  // ä¸åšæœ¬åœ°ä¹è§‚æ’å…¥ï¼Œç”±è°ƒç”¨æ–¹é€šè¿‡ fetchTasksByDate åˆ·æ–°åˆ—è¡¨ï¼Œé¿å…é‡å¤
  return newTask;
}
```

---

### Phase 9 - è®¿å®¢æ¨¡å¼å¼€å…³ï¼ˆGuest Modeï¼‰

**éœ€æ±‚èƒŒæ™¯**ï¼š
- å‘å¸ƒæ–°ç‰ˆæœ¬å‰ï¼Œå¸Œæœ›åœ¨æ‰‹æœºä¸Šæµ‹è¯•å‰ç«¯
- ç™»å½•é¡µå³ä¸Šè§’æ–°å¢å¼€å…³ï¼š
  - **å¼€å¯**ï¼šğŸ”’ ç™»å½•æ¨¡å¼ â†’ éœ€è¦æ³¨å†Œ/ç™»å½•æ‰èƒ½è¿›å…¥
  - **å…³é—­**ï¼šğŸ”“ è®¿å®¢æ¨¡å¼ â†’ ç›´æ¥è¿›å…¥ä¸»é¡µï¼Œæ— éœ€ç™»å½•

**å®ç°æ–¹æ¡ˆ**ï¼š

**1. pages/user/login.vue**

- å³ä¸Šè§’æ–°å¢ç‚¹å‡»åŒºåŸŸï¼ˆç»å¯¹å®šä½ï¼‰ï¼š
  ```html
  <view class="guest-toggle-wrap" @tap="toggleGuestMode">
    <text class="guest-toggle-icon">{{ guestMode ? 'ğŸ”“' : 'ğŸ”’' }}</text>
    <text class="guest-toggle-label">{{ guestMode ? 'è®¿å®¢æ¨¡å¼' : 'ç™»å½•æ¨¡å¼' }}</text>
  </view>
  ```

- åˆå§‹åŒ–çŠ¶æ€ï¼š
  ```js
  const guestMode = ref(!!uni.getStorageSync('guest_mode'));
  ```

- åˆ‡æ¢é€»è¾‘ï¼š
  ```js
  function toggleGuestMode() {
    guestMode.value = !guestMode.value;
    uni.setStorageSync('guest_mode', guestMode.value);
    if (guestMode.value) {
      // å¼€å¯è®¿å®¢æ¨¡å¼ï¼šç«‹åˆ»è¿›å…¥ä¸»é¡µ
      userStore.enterGuestMode();
      uni.reLaunch({ url: '/pages/calendar/index' });
    }
    // å…³é—­è®¿å®¢æ¨¡å¼ï¼šä¿æŒåœ¨ç™»å½•é¡µï¼Œç­‰å¾…ç”¨æˆ·ç™»å½•
  }
  ```

- æ ·å¼ï¼šåŠé€æ˜ç™½åº•å¡ç‰‡ï¼Œé˜´å½±ï¼Œç»å¯¹å®šä½ `top: 40rpx; right: 40rpx`

**2. App.vue**

- åœ¨ `onLaunch` æ—  Token åˆ†æ”¯å¢åŠ è®¿å®¢æ¨¡å¼åˆ¤æ–­ï¼š
  ```js
  } else {
    // æ—  Tokenï¼šæ£€æŸ¥æ˜¯å¦å¼€å¯äº†è®¿å®¢æ¨¡å¼
    const guestMode = uni.getStorageSync('guest_mode');
    if (guestMode) {
      // è®¿å®¢æ¨¡å¼å·²å¼€å¯ï¼šç›´æ¥è¿›å…¥ä¸»é¡µï¼Œæ— éœ€ç™»å½•
      const userStore = useUserStore();
      userStore.enterGuestMode();
      setTimeout(() => {
        uni.reLaunch({ url: '/pages/calendar/index' });
      }, 100);
    } else {
      // æ™®é€šæ¨¡å¼ï¼šè·³è½¬ç™»å½•é¡µ
      setTimeout(() => {
        uni.reLaunch({ url: '/pages/user/login' });
      }, 100);
    }
  }
  ```

**3. utils/request.js**

- 401 æ‹¦æˆªå™¨æ„ŸçŸ¥è®¿å®¢æ¨¡å¼ï¼š
  ```js
  } else if (res.statusCode === 401) {
    // Tokenå¤±æ•ˆï¼šè®¿å®¢æ¨¡å¼ä¸‹ä»…æç¤ºï¼Œä¸è·³è½¬ç™»å½•é¡µ
    const guestMode = uni.getStorageSync('guest_mode');
    if (guestMode) {
      uni.showToast({ title: 'è¯·ç™»å½•åä½¿ç”¨è¯¥åŠŸèƒ½', icon: 'none' });
      reject(new Error('è¯·ç™»å½•åä½¿ç”¨è¯¥åŠŸèƒ½'));
    } else {
      removeToken();
      removeUserInfo();
      uni.reLaunch({ url: '/pages/user/login' });
      reject(new Error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•'));
    }
  }
  ```

**4. store/user.js**

- æ–°å¢ `enterGuestMode()` actionï¼ˆå·²åœ¨ä¸Šä¸€ä¼šè¯å®Œæˆï¼‰ï¼š
  ```js
  enterGuestMode() {
    this.token = 'guest';
    this.userInfo = { id: 0, nickname: 'è®¿å®¢' };
  },
  ```

**ä½¿ç”¨æµç¨‹**ï¼š

| åœºæ™¯ | æ“ä½œ |
|---|---|
| é¦–æ¬¡ä½¿ç”¨ï¼Œæƒ³è·³è¿‡ç™»å½• | ç™»å½•é¡µå³ä¸Šè§’ç‚¹å‡» ğŸ”’ï¼Œå›¾æ ‡å˜ ğŸ”“"è®¿å®¢æ¨¡å¼"ï¼Œè‡ªåŠ¨è¿›å…¥ä¸»é¡µ |
| è®¿å®¢æ¨¡å¼ä¸‹æƒ³åˆ‡å›ç™»å½• | éœ€åœ¨ç™»å½•é¡µç‚¹å‡» ğŸ”“ï¼Œå˜å› ğŸ”’"ç™»å½•æ¨¡å¼"ï¼Œç•™åœ¨ç™»å½•é¡µå¡«å†™è´¦å· |
| è®¿å®¢æ¨¡å¼ä¸‹è§¦ç¢°éœ€ç™»å½•åŠŸèƒ½ | Toast æç¤º"è¯·ç™»å½•åä½¿ç”¨è¯¥åŠŸèƒ½"ï¼Œä¸å¼ºåˆ¶è·³è½¬ |
| App é‡å¯æ—¶è®¿å®¢æ¨¡å¼å·²å¼€å¯ | `App.vue` `onLaunch` è‡ªåŠ¨è¿›ä¸»é¡µï¼Œæ— éœ€é‡æ–°è®¾ç½® |

---

## å†³ç­–è®°å½•

| å†³ç­– | åŸå›  |
|------|------|
| H5 WheelPicker ç”¨é™æ€5é¡¹ä»£æ›¿ v-for | picker å†…éƒ¨ slot çš„ flex å­å…ƒç´ ä¸å‚ä¸æ¸²æŸ“ |
| RRULE æ ¼å¼ç”Ÿæˆå‚ç…§ task-edit.vue | ä¿æŒä¸ç°æœ‰ç¼–è¾‘é¡µé€»è¾‘ä¸€è‡´ï¼Œå‡å°‘ç»´æŠ¤æˆæœ¬ |
| range + recurring å¼ºåˆ¶äº’æ–¥ | åç«¯å°†åŒæ—¶å¸¦ä¸¤ä¸ªå±æ€§çš„ä»»åŠ¡å½’å…¥ä¸¤ä¸ªåˆ—è¡¨ï¼Œå¯¼è‡´UIé‡å¤æ˜¾ç¤º |
| hideLoading åœ¨ showToast ä¹‹å‰è°ƒç”¨ | showToast ä¼šéšå¼å…³é—­ loadingï¼Œé¿å…é…å¯¹è­¦å‘Š |
| è®¿å®¢æ¨¡å¼ token='guest' | å‰ç«¯ mockï¼Œæ— éœ€åç«¯æ”¹é€ ï¼Œ401æ‹¦æˆªå™¨å¯æ„ŸçŸ¥ |
| è®¿å®¢æ¨¡å¼å¼€å…³ç”¨emojiå›¾æ ‡ | æ— éœ€å›¾ç‰‡èµ„æºï¼Œè·¨å¹³å°å…¼å®¹æ€§å¥½ |

---

## é—®é¢˜ä¸è§£å†³

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| WheelPicker H5 é€‰ä¸­é¡¹ç©ºç™½ | æ”¹ä¸ºé™æ€5ä¸ª view ç›´æ¥å–ç´¢å¼•å€¼ |
| é‡å¤ä»»åŠ¡æäº¤æŠ¥é”™ | æ–°å¢ buildRrule() ç”Ÿæˆæ ‡å‡† RRULE æ ¼å¼ |
| startDate is required | æŒ‰ dateType åˆ†æ”¯å‘é€ä¸åŒæ—¥æœŸå­—æ®µ |
| showLoading/hideLoading è­¦å‘Š | åˆ é™¤ finallyï¼Œå„åˆ†æ”¯æ‰‹åŠ¨è°ƒç”¨ hideLoading |
| ä¸€æ¬¡æäº¤æ˜¾ç¤ºä¸¤æ¡ | ä¿®å¤ range+recurring äº’æ–¥é€»è¾‘ |
| è®¿å®¢æ¨¡å¼ä¸‹401è·³è½¬ | æ‹¦æˆªå™¨æ„ŸçŸ¥ guest_modeï¼Œä»… toast ä¸è·³è½¬ |

---

## è¿›åº¦æŠ¥å‘Š

| æ¨¡å— | å®Œæˆåº¦ |
|------|--------|
| RepeatPanel.vue è„šæœ¬éƒ¨åˆ† | 100% |
| WheelPicker H5 ä¿®å¤ | 100% |
| æäº¤æŠ¥é”™ä¿®å¤ï¼ˆrrule + startDateï¼‰ | 100% |
| ReminderPanel.vueï¼ˆ32-36.jpgï¼‰ | 100% |
| ä¸€æ¬¡æäº¤æ˜¾ç¤ºä¸¤æ¡ bug ä¿®å¤ | 100% |
| è®¿å®¢æ¨¡å¼å¼€å…³ | 100% |

**æ•´ä½“ Phase 3 è¿›åº¦**ï¼šçº¦ 90%

---

## æ˜æ—¥è®¡åˆ’

1. åœ¨ HBuilderX ä¸­è¿è¡Œï¼ŒéªŒè¯è®¿å®¢æ¨¡å¼ã€é‡å¤ä»»åŠ¡ã€æé†’åŠŸèƒ½
2. å¦‚æœ‰é—®é¢˜ï¼Œé’ˆå¯¹æ€§ä¿®å¤
3. ç»§ç»­æŒ‰åºæŸ¥çœ‹åç»­è®¾è®¡å›¾ï¼Œæ¨è¿›å…¶ä½™ UI åŠŸèƒ½

---

## ç›¸å…³ Git Commits

ï¼ˆå¾…ç”¨æˆ·æäº¤åè¡¥å……ï¼‰

**å˜æ›´æ–‡ä»¶æ¸…å•**ï¼š

| æ–‡ä»¶ | å˜æ›´å†…å®¹ |
|------|---------|
| `frontend/Planning-app/components/task/RepeatPanel.vue` | å®Œæˆè„šæœ¬éƒ¨åˆ†ï¼ˆæ¯æœˆ/æ¯å¹´é€»è¾‘ + WheelPicker é›†æˆï¼‰ |
| `frontend/Planning-app/components/task/WheelPicker.vue` | H5 ç«¯ä¿®å¤ï¼šåº•éƒ¨ safe-area padding + é™æ€5é¡¹æ˜¾ç¤º |
| `frontend/Planning-app/components/task/AddTaskPanel.vue` | buildRrule() + range/single æ—¥æœŸå­—æ®µä¿®å¤ + é˜²é‡å¤æäº¤ + range+recurring äº’æ–¥ + ReminderPanel é›†æˆ + hideLoading é…å¯¹ä¿®å¤ |
| `frontend/Planning-app/components/task/ReminderPanel.vue` | æ–°å»ºï¼ˆå¯¹åº”32-36.jpgè®¾è®¡ï¼‰ |
| `frontend/Planning-app/store/task.js` | ç§»é™¤ addTask ä¹è§‚ unshift |
| `frontend/Planning-app/pages/calendar/index.vue` | onTaskSubmitted ç®€åŒ– |
| `frontend/Planning-app/pages/user/login.vue` | å³ä¸Šè§’è®¿å®¢æ¨¡å¼å¼€å…³ |
| `frontend/Planning-app/App.vue` | onLaunch å¢åŠ  guest_mode åˆ†æ”¯ |
| `frontend/Planning-app/utils/request.js` | 401 æ‹¦æˆªå™¨æ„ŸçŸ¥è®¿å®¢æ¨¡å¼ |
| `frontend/Planning-app/store/user.js` | æ–°å¢ enterGuestMode() action |
