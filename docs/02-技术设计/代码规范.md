# 代码规范

> 本项目全程由 Claude AI 编写代码，规范确保不同会话间风格一致

## 1. 通用原则

- **语言**: JavaScript ES6+（不使用 TypeScript）
- **注释语言**: 中文（代码注释、文档、错误信息均使用中文）
- **文档注释**: 所有函数必须有 JSDoc 注释
- **代码格式**: ESLint + Prettier 强制执行，`npm run lint` 零警告

## 2. 命名规范

| 对象 | 规范 | 示例 |
|------|------|------|
| 变量/函数 | camelCase | `getUserInfo`, `planningList` |
| 类/构造函数 | PascalCase | `AppError`, `UserService` |
| 常量 | UPPER_SNAKE_CASE | `JWT_SECRET`, `MAX_PAGE_SIZE` |
| 文件名（后端） | camelCase.js | `errorHandler.js`, `userService.js` |
| 文件名（前端） | camelCase.js / PascalCase.vue | `request.js`, `UserCard.vue` |
| 数据库字段 | snake_case | `user_id`, `created_at` |
| API路径 | kebab-case | `/api/v1/planning-records` |

## 3. 后端规范

### 目录结构职责
```
controllers/  → 处理HTTP请求/响应，不含业务逻辑，调用services
services/     → 业务逻辑，不直接操作req/res
models/       → Sequelize模型定义，不含业务逻辑
routes/       → 路由注册，不含业务逻辑
middleware/   → 中间件
utils/        → 纯工具函数，无副作用
config/       → 配置文件
```

### 错误处理
- 业务错误：抛出 `AppError` 子类（在 `utils/errors.js`）
- 系统错误：由全局 `errorHandler` 捕获
- 永远不要在 controller 直接 `res.status(500).json({...})`

### 数据库操作
- 全部通过 Sequelize ORM，不写原生 SQL（复杂查询除外）
- 字段命名：DB `snake_case` ↔ JS `camelCase`（由 `underscored: true` 自动处理）
- 软删除：`paranoid: true`，不直接 DELETE 记录
- 密码字段：必须命名 `passwordHash` / `password_hash`，绝对不命名 `password`

## 4. 前端规范

### UniApp 约定
- 状态管理：Pinia（不用 Vuex）
- HTTP请求：统一通过 `utils/request.js`（不直接调用 `uni.request`）
- 存储：统一通过 `utils/storage.js`
- 平台差异：使用 `// #ifdef` 条件编译，不拆分目录

### 组件规范
- 每个页面组件必须设置 `name` 属性
- 事件处理方法前缀 `handle`：`handleLogin`, `handleSubmit`
- 跳转方法前缀 `go`：`goDetail`, `goCreate`

## 5. Git 提交规范

```
feat(scope): 新增功能
fix(scope): 修复Bug
refactor(scope): 重构代码
docs(scope): 文档更新
test(scope): 测试相关
chore(scope): 构建/工具更新
```

示例：`feat(auth): 实现JWT登录接口`

## 6. API 响应格式

所有接口统一返回：
```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": "2026-02-17T00:00:00.000Z"
}
```
